plugins {
  id("java")
  id("maven-publish")
  id("com.github.johnrengelman.shadow") version "7.0.0"
}

apply from: "$rootDir/gradle/shadow.gradle"

project.archivesBaseName = 'solarwinds-otel-sdk'


dependencies {
  compileOnly("io.opentelemetry:opentelemetry-sdk:${versions.opentelemetry}")
  compileOnly("io.opentelemetry.javaagent:opentelemetry-javaagent-bootstrap:${versions.opentelemetryJavaagentAlpha}")
  compileOnly "com.appoptics.agent.java:core:${versions.appopticsCore}"
  compileOnly "com.appoptics.agent.java:metrics:${versions.appopticsMetrics}"
  compileOnly project(":custom")
  compileOnly project(":core-bootstrap")
  testImplementation "junit:junit:4.10"
  testImplementation "com.appoptics.agent.java:core:${versions.appopticsCore}"
  testImplementation "com.appoptics.agent.java:metrics:${versions.appopticsMetrics}"
}

publishing {
  publications {
    maven(MavenPublication) {
      groupId = project.group
      artifactId = "${archivesBaseName}"
      version = "${versions.agent}"
      from components.java
    }
  }
  repositories {
    maven {
      name = "OSSRH"
      url = "https://oss.sonatype.org/service/local/staging/deploy/maven2/"
      credentials {
        username = System.getenv("MAVEN_USERNAME")
        password = System.getenv("MAVEN_PASSWORD")
      }
    }
    maven {
      name = "GitHubPackages"
      url = "https://maven.pkg.github.com/appoptics/solarwinds-apm-java"
      credentials {
        username = System.getenv("GITHUB_ACTOR")
        password = System.getenv("GITHUB_TOKEN")
      }
    }
  }
}

